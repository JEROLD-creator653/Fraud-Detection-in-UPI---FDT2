<!-- templates/dashboard.html (compact/responsive version) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UPI Fraud Detection Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/static/dashboard.css">
</head>

<body class="py-6">
  <div class="max-w-6xl mx-auto px-4">

    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-3xl md:text-4xl font-extrabold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent leading-tight">
          UPI Fraud Detection System
        </h1>
        <p class="text-gray-600 small-text mt-1">Real-time monitoring â€¢ Sri Sairam Engineering College</p>
      </div>
      <div class="flex gap-3 items-center">
        <select id="timeRange" class="px-3 py-2 border rounded-lg bg-white small-text">
          <option value="1h">Last Hour</option>
          <option value="24h" selected>Last 24 Hours</option>
          <option value="7d">Last 7 Days</option>
          <option value="30d">Last 30 Days</option>
        </select>

        <button id="infoBtn" class="px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-600 text-white rounded-lg small-text hover:shadow-lg transition-all" title="Risk Score Info">
          â„¹ï¸ Risk Score
        </button>

        <button id="exportBtn" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg small-text">
          Export
        </button>

        <!-- Dark Mode Toggle Button -->
        <button id="darkModeToggle" class="px-4 py-2 bg-gradient-to-r from-indigo-600 to-blue-600 text-white rounded-lg small-text hover:shadow-lg transition-all" title="Toggle Dark Mode">
          ğŸŒ™ Dark
        </button>

        <!-- ADMIN LOGIN BUTTON ADDED (redirects to admin login) -->
        <a id="adminLoginBtn" href="/admin/login" class="px-4 py-2 bg-gradient-to-r from-orange-600 to-red-600 text-white rounded-lg small-text hover:shadow-lg transition-all">Admin Login</a>
      </div>
    </div>

    <!-- Stats -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      <div class="card accent-border" style="border-color:#6366F1">
        <p class="text-gray-600 small-text">Total Transactions</p>
        <h2 id="totalTx" class="text-2xl stat-value text-[#6366F1]">0</h2>
        <p class="text-xs text-gray-500">Last 24 hours</p>
      </div>

      <div class="card accent-border" style="border-color:#EF4444">
        <p class="text-gray-600 small-text">Blocked</p>
        <h2 id="blockedTx" class="text-2xl stat-value text-[#EF4444]">0</h2>
        <p class="text-xs text-gray-500">Requires review</p>
      </div>

      <div class="card accent-border" style="border-color:#F59E0B">
        <p class="text-gray-600 small-text">Delayed</p>
        <h2 id="delayedTx" class="text-2xl stat-value text-[#F59E0B]">0</h2>
        <p class="text-xs text-gray-500">Pending verification</p>
      </div>

      <div class="card accent-border" style="border-color:#10B981">
        <p class="text-gray-600 small-text">Allowed</p>
        <h2 id="allowedTx" class="text-2xl stat-value text-[#10B981]">0</h2>
        <p class="text-xs text-gray-500">Cleared</p>
      </div>
    </div>

    <!-- Charts + table grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
      <div class="lg:col-span-2 card">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-bold">Transaction Activity Timeline</h3>
          <div class="text-sm text-gray-500">Real-time</div>
        </div>
        <div class="chart-wrap">
          <canvas id="timelineChart" style="height:220px;width:100%"></canvas>
        </div>
      </div>

      <div class="card">
        <h3 class="text-lg font-bold mb-3">Risk Distribution</h3>
        <div class="chart-wrap">
          <canvas id="riskPie" style="height:220px;width:100%"></canvas>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
      <div class="card">
        <h3 class="text-lg font-bold mb-3">Fraud Pattern Analysis</h3>
        <div class="chart-wrap">
          <canvas id="fraudBar" style="height:220px;width:100%"></canvas>
        </div>
      </div>

      <div class="card">
        <div class="flex items-center gap-2 mb-3">
          <h3 class="text-lg font-bold">Recent High-Risk Alerts</h3>
          <div class="relative group">
            <span class="text-gray-400 dark:text-gray-500 cursor-help text-sm font-bold">â„¹ï¸</span>
            <div class="absolute bottom-full left-0 mb-2 w-48 p-2 bg-gray-900 dark:bg-gray-800 text-white dark:text-gray-100 text-xs rounded-lg opacity-0 pointer-events-none group-hover:opacity-100 transition-opacity duration-200 z-50 whitespace-normal">
              Transactions with risk score greater than 0.80 are flagged as high-risk and require immediate attention.
            </div>
          </div>
        </div>
        <div id="alertsList" class="space-y-2 max-h-[300px] overflow-y-auto small-text text-gray-700">
        </div>
      </div>
    </div>

    <div class="card mb-6">
  <div class="flex items-center justify-between mb-2">
    <h3 class="text-lg font-bold">Recent Transactions</h3>

    <!-- ğŸ”½ ADDED: Action filter dropdown -->
    <select id="txFilter"
      class="px-3 py-1 border rounded-md text-sm bg-white">
      <option value="ALL">All</option>
      <option value="ALLOW">Allowed</option>
      <option value="BLOCK">Blocked</option>
      <option value="DELAY">Delayed</option>
    </select>
  </div>
      <div class="overflow-x-auto table-scroll">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-50 small-text">
            <tr>
              <th class="px-3 py-2 text-left">Time</th>
              <th class="px-3 py-2 text-left">TX ID</th>
              <th class="px-3 py-2 text-left">User</th>
              <th class="px-3 py-2 text-left">Amount</th>
              <th class="px-3 py-2 text-left">Type</th>
              <th class="px-3 py-2 text-left">Channel</th>
              <th class="px-3 py-2 text-left">Risk Score</th>
            </tr>
          </thead>
          <tbody id="txTbody" class="bg-white divide-y divide-gray-100 small-text">
          </tbody>
        </table>
      </div>
      <div class="mt-3 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 border-l-4 border-blue-500 dark:border-blue-400 rounded-lg">
        <p class="text-sm font-medium text-blue-800 dark:text-blue-100 transition-colors duration-100">
          ğŸ’¡ <strong>Tip:</strong> For entire transaction data, click the <strong>Export</strong> button to download as CSV file.
        </p>
      </div>
    </div>

    <div class="bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl p-3 text-white flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-3 h-3 bg-white rounded-full animate-pulse"></div>
        <div>
          <div class="font-bold small-text">System Status: Active</div>
          <div class="text-xs opacity-90">Realtime websocket updates</div>
        </div>
      </div>
      <div class="flex gap-4 text-xs">
        <div>ML Accuracy: <span class="font-bold">98.7%</span></div>
        <div>Avg RT: <span class="font-bold">12ms</span></div>
        <div>Active Users: <span class="font-bold" id="activeUsers">0</span></div>
      </div>
    </div>

  </div>

  <!-- Risk Score Info Modal -->
  <div class="modal-overlay" id="riskScoreModal">
    <div class="info-modal">
      <div class="info-modal-header">
        <h2>ğŸ“Š Understanding Risk Scores</h2>
        <button class="close-btn" id="closeModal" title="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      
      <div class="info-modal-content">
        <div class="info-section">
          <h3>ğŸ’¡ What is a Risk Score?</h3>
          <p>
            A <strong>Risk Score</strong> is a numerical value ranging from <strong>0 to 1</strong> that represents 
            the probability of a transaction being fraudulent. Our advanced fraud detection system analyzes multiple 
            factors to calculate this score in real-time.
          </p>
        </div>

        <div class="info-section">
          <h3>ğŸ” Factors That Influence Risk Score</h3>
          <div class="risk-factors">
            <ul>
              <li><strong>Transaction Amount</strong> â€“ Unusually large or unusual transaction amounts trigger higher risk</li>
              <li><strong>User History</strong> â€“ Frequency patterns, transaction history, and account behavior</li>
              <li><strong>Device ID</strong> â€“ New devices, location mismatches, and suspicious device activity</li>
              <li><strong>Transaction Type</strong> â€“ Person-to-person, bill payments, fund transfers, etc.</li>
              <li><strong>Channel</strong> â€“ Mobile app, web, SMS, USSD, and other channels</li>
              <li><strong>Recipient VPA Patterns</strong> â€“ Patterns and history of the recipient's Virtual Payment Address</li>
            </ul>
          </div>
        </div>

        <div class="info-section">
          <h3>âš–ï¸ Risk Score Thresholds</h3>
          <div class="risk-threshold">
            <div class="threshold-card low-risk">
              <div class="emoji">âœ…</div>
              <div class="label">LOW RISK</div>
              <div class="value">0.0 - 0.29</div>
              <div class="desc">Transaction ALLOWED automatically</div>
            </div>
            <div class="threshold-card medium-risk">
              <div class="emoji">âš ï¸</div>
              <div class="label">MEDIUM RISK</div>
              <div class="value">0.30 - 0.59</div>
              <div class="desc">Transaction DELAYED for verification</div>
            </div>
            <div class="threshold-card high-risk">
              <div class="emoji">ğŸš«</div>
              <div class="label">HIGH RISK</div>
              <div class="value">0.60 - 1.0</div>
              <div class="desc">Transaction BLOCKED immediately</div>
            </div>
          </div>
        </div>

        <div class="info-section">
          <h3>ğŸ“ˆ How It Works</h3>
          <p>
            When a transaction is initiated, our machine learning models instantly:
          </p>
          <div class="risk-factors">
            <ul>
              <li>Analyze the transaction details and user profile</li>
              <li>Compare against historical patterns and known fraud indicators</li>
              <li>Generate a risk score based on weighted factors</li>
              <li>Make an automatic decision (Allow/Delay/Block)</li>
              <li>Log the transaction for audit and continuous improvement</li>
            </ul>
          </div>
        </div>

        <div class="info-section">
          <div class="info-highlight">
            ğŸ¯ <strong>Current System Performance:</strong> Our system analyzes transactions in milliseconds, 
            achieving high accuracy while maintaining seamless user experience.
          </div>
        </div>

        <div class="info-section">
          <div class="info-tip">
            ğŸ’¡ <strong>Tip:</strong> Use the AI Assistant chatbot to ask about specific transactions, 
            analyze risk patterns, and get detailed fraud detection insights. Click the ğŸ’¬ button at the bottom-right!
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- AI Chatbot Widget - Premium Design -->
  <div class="chatbot-container">
    <button class="chatbot-button" id="chatbotToggle" aria-label="Toggle Chatbot" title="AI Assistant">
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2C6.48 2 2 6.48 2 12C2 13.93 2.65 15.71 3.75 17.13L2.05 21.95L7.13 20.25C8.56 21.35 10.22 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z" fill="white" opacity="0.9"/>
        <circle cx="8" cy="12" r="1.5" fill="white"/>
        <circle cx="12" cy="12" r="1.5" fill="white"/>
        <circle cx="16" cy="12" r="1.5" fill="white"/>
      </svg>
    </button>
    
    <div class="chatbot-window" id="chatbotWindow">
      <div class="chatbot-header">
        <div>
          <div class="font-bold">ğŸ’¬ SYNARA </div>
          <div class="text-xs">Fraud Detection Analytics</div>
        </div>
        <button id="chatbotClose" class="text-white hover:opacity-70 transition-opacity" title="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      
      <div class="chatbot-messages" id="chatbotMessages">
        <div class="chatbot-message bot">
          <div class="chatbot-message-content">
            <strong style="font-size: 16px; color: #667eea;">ğŸ‘‹ Welcome!</strong>

I'm Synara your AI assistant for the UPI Fraud Detection System. I analyze transactions and provide real-time fraud detection insights.

<strong>What I Can Help You With:</strong>

â€¢ ğŸ“Š Analytics & statistics
â€¢ ğŸ” Individual transaction details
â€¢ ğŸ“ˆ Fraud patterns & trends
â€¢ ğŸ’¡ Risk score analysis

<strong>Try asking:</strong>

â€¢ "Analyse last 5 transactions"
â€¢ "Show me high-risk transactions"
â€¢ "What's the total fraud rate?"
â€¢ "Explain transaction X" (with ID)

What would you like to know?
          </div>
        </div>
      </div>
      
      <div class="chatbot-input-area">
        <div class="chatbot-input-wrapper">
          <input 
            type="text" 
            class="chatbot-input" 
            id="chatbotInput" 
            placeholder="Ask anything... (e.g., 'analyse last 5 transactions')"
            autocomplete="off"
          />
          <button class="chatbot-send-btn" id="chatbotSend" title="Send message">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16.6915026,12.4744748 L3.50612381,13.2599618 C3.19218622,13.2599618 3.03521743,13.4170592 3.03521743,13.5741566 L1.15159189,20.0151496 C0.8376543,20.8006365 0.99,21.89 1.77946707,22.52 C2.41,22.99 3.50612381,23.1 4.13399899,22.8429026 L21.714504,14.0454487 C22.6563168,13.5741566 23.1272231,12.6315722 22.9702544,11.6889879 L4.13399899,1.16640469 C3.34915502,0.9 2.40734225,1.00636533 1.77946707,1.4776575 C0.994623095,2.10604706 0.837654326,3.0486314 1.15159189,3.99 L3.03521743,10.4309931 C3.03521743,10.5880905 3.19218622,10.7451879 3.50612381,10.7451879 L16.6915026,11.5306748 C16.6915026,11.5306748 17.1624089,11.5306748 17.1624089,12.0019669 C17.1624089,12.4732591 16.6915026,12.4744748 16.6915026,12.4744748 Z" fill="currentColor"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/dashboard.js"></script>
</body>
</html>